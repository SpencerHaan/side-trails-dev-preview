import{r as n}from"./index.Dy7WD_uu.js";import{b as h}from"./index.C0jEKc2e.js";import{u as R,P as g,d as _}from"./utils.DwbP7QOt.js";import{j as x}from"./index.DpG565of.js";function m(t){const e=n.useRef(t);return n.useEffect(()=>{e.current=t}),n.useMemo(()=>(...s)=>e.current?.(...s),[])}function U(t,e=globalThis?.document){const s=m(t);n.useEffect(()=>{const o=r=>{r.key==="Escape"&&s(r)};return e.addEventListener("keydown",o,{capture:!0}),()=>e.removeEventListener("keydown",o,{capture:!0})},[s,e])}var j="DismissableLayer",p="dismissableLayer.update",z="dismissableLayer.pointerDownOutside",H="dismissableLayer.focusOutside",C,T=n.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),K=n.forwardRef((t,e)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:o,onPointerDownOutside:r,onFocusOutside:u,onInteractOutside:f,onDismiss:d,...E}=t,a=n.useContext(T),[c,F]=n.useState(null),l=c?.ownerDocument??globalThis?.document,[,I]=n.useState({}),S=R(e,i=>F(i)),b=Array.from(a.layers),[W]=[...a.layersWithOutsidePointerEventsDisabled].slice(-1),k=b.indexOf(W),D=c?b.indexOf(c):-1,A=a.layersWithOutsidePointerEventsDisabled.size>0,P=D>=k,N=Y(i=>{const v=i.target,L=[...a.branches].some(y=>y.contains(v));!P||L||(r?.(i),f?.(i),i.defaultPrevented||d?.())},l),O=q(i=>{const v=i.target;[...a.branches].some(y=>y.contains(v))||(u?.(i),f?.(i),i.defaultPrevented||d?.())},l);return U(i=>{D===a.layers.size-1&&(o?.(i),!i.defaultPrevented&&d&&(i.preventDefault(),d()))},l),n.useEffect(()=>{if(c)return s&&(a.layersWithOutsidePointerEventsDisabled.size===0&&(C=l.body.style.pointerEvents,l.body.style.pointerEvents="none"),a.layersWithOutsidePointerEventsDisabled.add(c)),a.layers.add(c),w(),()=>{s&&a.layersWithOutsidePointerEventsDisabled.size===1&&(l.body.style.pointerEvents=C)}},[c,l,s,a]),n.useEffect(()=>()=>{c&&(a.layers.delete(c),a.layersWithOutsidePointerEventsDisabled.delete(c),w())},[c,a]),n.useEffect(()=>{const i=()=>I({});return document.addEventListener(p,i),()=>document.removeEventListener(p,i)},[]),x.jsx(g.div,{...E,ref:S,style:{pointerEvents:A?P?"auto":"none":void 0,...t.style},onFocusCapture:h(t.onFocusCapture,O.onFocusCapture),onBlurCapture:h(t.onBlurCapture,O.onBlurCapture),onPointerDownCapture:h(t.onPointerDownCapture,N.onPointerDownCapture)})});K.displayName=j;var M="DismissableLayerBranch",X=n.forwardRef((t,e)=>{const s=n.useContext(T),o=n.useRef(null),r=R(e,o);return n.useEffect(()=>{const u=o.current;if(u)return s.branches.add(u),()=>{s.branches.delete(u)}},[s.branches]),x.jsx(g.div,{...t,ref:r})});X.displayName=M;function Y(t,e=globalThis?.document){const s=m(t),o=n.useRef(!1),r=n.useRef(()=>{});return n.useEffect(()=>{const u=d=>{if(d.target&&!o.current){let E=function(){B(z,s,a,{discrete:!0})};const a={originalEvent:d};d.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=E,e.addEventListener("click",r.current,{once:!0})):E()}else e.removeEventListener("click",r.current);o.current=!1},f=window.setTimeout(()=>{e.addEventListener("pointerdown",u)},0);return()=>{window.clearTimeout(f),e.removeEventListener("pointerdown",u),e.removeEventListener("click",r.current)}},[e,s]),{onPointerDownCapture:()=>o.current=!0}}function q(t,e=globalThis?.document){const s=m(t),o=n.useRef(!1);return n.useEffect(()=>{const r=u=>{u.target&&!o.current&&B(H,s,{originalEvent:u},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,s]),{onFocusCapture:()=>o.current=!0,onBlurCapture:()=>o.current=!1}}function w(){const t=new CustomEvent(p);document.dispatchEvent(t)}function B(t,e,s,{discrete:o}){const r=s.originalEvent.target,u=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:s});e&&r.addEventListener(t,e,{once:!0}),o?_(r,u):r.dispatchEvent(u)}export{K as D,m as u};
